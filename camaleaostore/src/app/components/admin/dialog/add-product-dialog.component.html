<div class="dialog-wrap">

    <!-- Botão X -->
    <button mat-icon-button class="close-btn" aria-label="Fechar" (click)="close()">
        <mat-icon>close</mat-icon>
    </button>

    <h2 class="title">Adicionar nova peça</h2>

    <form [formGroup]="form" class="dialog-grid" (ngSubmit)="save()">

        <!-- COLUNA ESQUERDA: upload + preview (compacto) -->
        <section class="media">

            <!-- QUANDO JÁ HÁ IMAGEM: preview + botões -->
            <div class="preview" *ngIf="form.value.imagemBase64; else noImg">
                <img [src]="form.value.imagemBase64!" alt="Preview da peça" />

                <div class="img-actions">
                    <input #fileInput type="file" accept="image/*" hidden (change)="onFile($event)" />
                    <button mat-stroked-button type="button" (click)="fileInput.click()">
                        <mat-icon>photo_library</mat-icon>
                        Trocar imagem
                    </button>

                    <button mat-stroked-button color="warn" type="button" (click)="removeImage()">
                        <mat-icon>delete</mat-icon>
                        Remover
                    </button>
                </div>
            </div>

            <!-- QUANDO NÃO HÁ IMAGEM: só um botão -->
            <ng-template #noImg>
                <div class="uploader">
                    <input #fileInput2 type="file" accept="image/*" hidden (change)="onFile($event)" />
                    <button mat-stroked-button type="button" class="select-btn" (click)="fileInput2.click()">
                        <mat-icon>add_a_photo</mat-icon>
                        Selecionar imagem
                    </button>
                    <div class="hint">JPG ou PNG • até 5MB</div>
                </div>
            </ng-template>

        </section>


        <!-- COLUNA DIREITA: campos -->
        <section class="form">
            <mat-form-field appearance="outline" class="full">
                <mat-label>Título</mat-label>
                <input matInput formControlName="titulo" required>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Preço (R$)</mat-label>
                <input matInput type="number" step="0.01" formControlName="preco">
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Categoria</mat-label>
                <mat-select formControlName="categoriaId">
                    <mat-option [value]="null">—</mat-option>
                    <mat-option *ngFor="let c of data.categorias" [value]="c.id">{{ c.nome }}</mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full">
                <mat-label>Descrição</mat-label>
                <textarea matInput rows="3" formControlName="descricao"></textarea>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Tamanhos (separados por vírgula)</mat-label>
                <input matInput placeholder="P, M, G" formControlName="tamanhosText">
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Link (href)</mat-label>
                <input matInput placeholder="/produto/slug" formControlName="href">
            </mat-form-field>
        </section>

        <!-- AÇÕES -->
        <div class="actions full">
            <button mat-stroked-button type="button" (click)="close()">Cancelar</button>
            <button mat-flat-button color="primary" [disabled]="form.invalid || saving" type="submit">
                <mat-icon>check</mat-icon>
                Salvar
            </button>
        </div>
    </form>
</div>