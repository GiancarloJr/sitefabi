<div class="container">

  <div class="admin-toolbar">
    <h2>Produtos</h2>
    <button mat-stroked-button color="primary" (click)="logout()">
      <mat-icon>logout</mat-icon>
      Sair
    </button>
  </div>

  <form class="filters" [formGroup]="filters">
    <mat-form-field appearance="outline">
      <mat-label>Título</mat-label>
      <input matInput placeholder="Ex.: Camiseta" formControlName="titulo">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Preço mín.</mat-label>
      <input matInput type="number" step="0.01" formControlName="precoMin">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Preço máx.</mat-label>
      <input matInput type="number" step="0.01" formControlName="precoMax">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Tamanho</mat-label>
      <input matInput placeholder="Ex.: M" formControlName="tamanho">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Categoria</mat-label>
      <mat-select formControlName="categoriaId">
        <mat-option [value]="null">Todas</mat-option>
        <mat-option *ngFor="let c of categorias" [value]="c.id">{{ c.nome }}</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-button type="button" (click)="clearFilters()" matTooltip="Limpa todos os filtros">
      <mat-icon>clear</mat-icon>
      Limpar
    </button>
  </form>

  <div class="mat-elevation-z8 table-wrapper" [class.loading]="loading">
    <div class="loading-backdrop" *ngIf="loading">Carregando…</div>

    <table mat-table [dataSource]="dataSource" matSort>

      <!-- Imagem -->
      <ng-container matColumnDef="imagem">
        <th mat-header-cell *matHeaderCellDef> Foto </th>
        <td mat-cell *matCellDef="let row">
          <img *ngIf="row.imagem_base64; else semImg" [src]="row.imagem_base64" width="150" height="220" class="thumb"
            alt="Imagem de {{row.titulo}}">
          <ng-template #semImg>
            <div class="noimg">—</div>
          </ng-template>
        </td>
      </ng-container>

      <!-- Título -->
      <ng-container matColumnDef="titulo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Título </th>
        <td mat-cell *matCellDef="let row"> {{ row.titulo }} </td>
      </ng-container>

      <!-- Preço -->
      <ng-container matColumnDef="preco">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Preço </th>
        <td mat-cell *matCellDef="let row">
          <ng-container *ngIf="row.preco != null; else semPreco">
            {{ row.preco | currency:'BRL':'symbol':'1.2-2' }}
          </ng-container>
          <ng-template #semPreco>—</ng-template>
        </td>
      </ng-container>

      <!-- Descrição -->
      <ng-container matColumnDef="descricao">
        <th mat-header-cell *matHeaderCellDef> Descrição </th>
        <td mat-cell *matCellDef="let row" class="descricao">
          {{ row.descricao || '—' }}
        </td>
      </ng-container>

      <!-- Tamanhos -->
      <ng-container matColumnDef="tamanhos">
        <th mat-header-cell *matHeaderCellDef> Tamanhos </th>
        <td mat-cell *matCellDef="let row">
          <mat-chip-set *ngIf="row.tamanhos?.length; else semTam">
            <mat-chip *ngFor="let t of row.tamanhos" disableRipple>{{ t }}</mat-chip>
          </mat-chip-set>
          <ng-template #semTam>—</ng-template>
        </td>
      </ng-container>

      <!-- Categoria -->
      <ng-container matColumnDef="categoria">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Categoria </th>
        <td mat-cell *matCellDef="let row">
          {{ row.categoria_nome || '—' }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          Nenhum produto corresponde aos filtros.
        </td>
      </tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10" aria-label="Paginação de produtos">
    </mat-paginator>
  </div>

</div>